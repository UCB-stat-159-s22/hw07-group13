
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Predicting Concentrations of PM2.5 &#8212; AQ Project Jupyter Book</title>
    
  <link href="_static/css/theme.css" rel="stylesheet">
  <link href="_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/togglebutton.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/sphinx-book-theme.d59cb220de22ca1c485ebbdc042f0030.js"></script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script>
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Analysing the dark day over San Francisco (Sep 9 2020)" href="modelling.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="_static/orangeskies.jpeg" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">AQ Project Jupyter Book</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="Main.html">
   Exploring the Air Quality of the San Francisco Bay Area using OpenAQ
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Analysis Notebooks
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="ExplorationAndVisualization.html">
   Exploring and Visualizing OpenAQ Data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="LA_Visualizations.html">
   Los Angeles Exploration &amp; Visualization
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="modelling.html">
   Analysing the dark day over San Francisco (Sep 9 2020)
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Predicting Concentrations of PM
   <sub>
    2.5
   </sub>
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="_sources/MainAnalysis.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
                onclick="printPdf(this)" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/executablebooks/jupyter-book/master?urlpath=tree/MainAnalysis.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show noprint">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#version-1">
   Version 1
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#version-2">
   Version 2
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#regression-with-wind-speed-and-relative-humidity-data">
     Regression with wind speed and relative humidity data
    </a>
   </li>
  </ul>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Predicting Concentrations of PM<sub>2.5</sub></h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#version-1">
   Version 1
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#version-2">
   Version 2
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#regression-with-wind-speed-and-relative-humidity-data">
     Regression with wind speed and relative humidity data
    </a>
   </li>
  </ul>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            
              <div>
                
  <div class="tex2jax_ignore mathjax_ignore section" id="predicting-concentrations-of-pm-sub-2-5-sub">
<h1>Predicting Concentrations of PM<sub>2.5</sub><a class="headerlink" href="#predicting-concentrations-of-pm-sub-2-5-sub" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">openaq</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">RobustScaler</span>
<span class="kn">from</span> <span class="nn">aqtools</span> <span class="kn">import</span> <span class="n">aqutils</span> <span class="k">as</span> <span class="n">u</span>

<span class="kn">from</span> <span class="nn">tensorflow.keras</span> <span class="kn">import</span> <span class="n">Sequential</span>
<span class="kn">from</span> <span class="nn">tensorflow.keras.layers</span> <span class="kn">import</span> <span class="n">Dense</span><span class="p">,</span> <span class="n">GRU</span>
<span class="kn">from</span> <span class="nn">tensorflow.keras.callbacks</span> <span class="kn">import</span> <span class="n">EarlyStopping</span><span class="p">,</span> <span class="n">ModelCheckpoint</span>
<span class="kn">from</span> <span class="nn">tensorflow.keras.optimizers</span> <span class="kn">import</span> <span class="n">SGD</span>

<span class="kn">from</span> <span class="nn">noaa_sdk</span> <span class="kn">import</span> <span class="n">noaa</span>

<span class="n">api</span> <span class="o">=</span> <span class="n">openaq</span><span class="o">.</span><span class="n">OpenAQ</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="version-1">
<h2>Version 1<a class="headerlink" href="#version-1" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Parameter setting</span>

<span class="n">date_from</span> <span class="o">=</span> <span class="s1">&#39;2021-09-01T00:00:00Z&#39;</span> <span class="c1"># Default: PST</span>
<span class="n">date_to</span> <span class="o">=</span> <span class="s1">&#39;2022-03-01T00:00:00Z&#39;</span>
<span class="n">city</span> <span class="o">=</span> <span class="s1">&#39;San Francisco-Oakland-Fremont&#39;</span>
<span class="n">location</span> <span class="o">=</span> <span class="s1">&#39;Oakland&#39;</span>
<span class="n">data_query_limit</span> <span class="o">=</span> <span class="mi">4000</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Important! You may get &#39;ApiError: A bad request was made: 500&#39;.</span>
<span class="sd">It&#39;s not because of our code but  of API server issue.</span>
<span class="sd">Please take a moment, and retry executing the cell.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="c1"># co</span>
<span class="n">pollutant</span> <span class="o">=</span> <span class="s1">&#39;co&#39;</span>
<span class="n">status</span><span class="p">,</span> <span class="n">resp</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">measurements</span><span class="p">(</span><span class="n">city</span><span class="o">=</span><span class="n">city</span><span class="p">,</span>
                                <span class="n">location</span><span class="o">=</span><span class="n">location</span><span class="p">,</span> <span class="n">parameter</span><span class="o">=</span><span class="n">pollutant</span><span class="p">,</span>
                                <span class="n">date_from</span><span class="o">=</span><span class="n">date_from</span><span class="p">,</span>
                                <span class="n">date_to</span><span class="o">=</span><span class="n">date_to</span><span class="p">,</span>
                                <span class="n">limit</span><span class="o">=</span><span class="n">data_query_limit</span><span class="p">)</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">resp</span><span class="p">[</span><span class="s1">&#39;results&#39;</span><span class="p">]</span>
<span class="n">df_co</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">date_pollutant_value</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">pollutant</span><span class="p">)</span>
<span class="n">df_co</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>date</th>
      <th>co</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>3600</th>
      <td>2021-08-31 17:00:00</td>
      <td>0.3</td>
    </tr>
    <tr>
      <th>3599</th>
      <td>2021-08-31 18:00:00</td>
      <td>0.3</td>
    </tr>
    <tr>
      <th>3598</th>
      <td>2021-08-31 19:00:00</td>
      <td>0.3</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># no2</span>
<span class="n">pollutant</span> <span class="o">=</span> <span class="s1">&#39;no2&#39;</span>
<span class="n">status</span><span class="p">,</span> <span class="n">resp</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">measurements</span><span class="p">(</span><span class="n">city</span><span class="o">=</span><span class="n">city</span><span class="p">,</span>
                                <span class="n">location</span><span class="o">=</span><span class="n">location</span><span class="p">,</span> <span class="n">parameter</span><span class="o">=</span><span class="n">pollutant</span><span class="p">,</span>
                                <span class="n">date_from</span><span class="o">=</span><span class="n">date_from</span><span class="p">,</span>
                                <span class="n">date_to</span><span class="o">=</span><span class="n">date_to</span><span class="p">,</span>
                                <span class="n">limit</span><span class="o">=</span><span class="n">data_query_limit</span><span class="p">)</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">resp</span><span class="p">[</span><span class="s1">&#39;results&#39;</span><span class="p">]</span>
<span class="n">df_no2</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">date_pollutant_value</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">pollutant</span><span class="p">)</span>

<span class="n">df_no2</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>date</th>
      <th>no2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>3599</th>
      <td>2021-08-31 17:00:00</td>
      <td>0.002</td>
    </tr>
    <tr>
      <th>3598</th>
      <td>2021-08-31 18:00:00</td>
      <td>0.003</td>
    </tr>
    <tr>
      <th>3597</th>
      <td>2021-08-31 19:00:00</td>
      <td>0.004</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># o3</span>
<span class="n">pollutant</span> <span class="o">=</span> <span class="s1">&#39;o3&#39;</span>
<span class="n">status</span><span class="p">,</span> <span class="n">resp</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">measurements</span><span class="p">(</span><span class="n">city</span><span class="o">=</span><span class="n">city</span><span class="p">,</span>
                                <span class="n">location</span><span class="o">=</span><span class="n">location</span><span class="p">,</span> <span class="n">parameter</span><span class="o">=</span><span class="n">pollutant</span><span class="p">,</span>
                                <span class="n">date_from</span><span class="o">=</span><span class="n">date_from</span><span class="p">,</span>
                                <span class="n">date_to</span><span class="o">=</span><span class="n">date_to</span><span class="p">,</span>
                                <span class="n">limit</span><span class="o">=</span><span class="n">data_query_limit</span><span class="p">)</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">resp</span><span class="p">[</span><span class="s1">&#39;results&#39;</span><span class="p">]</span>
<span class="n">df_o3</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">r</span><span class="p">)</span>
<span class="n">df_o3</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">date_pollutant_value</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">pollutant</span><span class="p">)</span>

<span class="n">df_o3</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>date</th>
      <th>o3</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>3600</th>
      <td>2021-08-31 17:00:00</td>
      <td>0.031</td>
    </tr>
    <tr>
      <th>3599</th>
      <td>2021-08-31 18:00:00</td>
      <td>0.031</td>
    </tr>
    <tr>
      <th>3598</th>
      <td>2021-08-31 19:00:00</td>
      <td>0.030</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># pm25</span>
<span class="n">pollutant</span> <span class="o">=</span> <span class="s1">&#39;pm25&#39;</span>
<span class="n">status</span><span class="p">,</span> <span class="n">resp</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">measurements</span><span class="p">(</span><span class="n">city</span><span class="o">=</span><span class="n">city</span><span class="p">,</span>
                                <span class="n">location</span><span class="o">=</span><span class="n">location</span><span class="p">,</span> <span class="n">parameter</span><span class="o">=</span><span class="n">pollutant</span><span class="p">,</span>
                                <span class="n">date_from</span><span class="o">=</span><span class="n">date_from</span><span class="p">,</span>
                                <span class="n">date_to</span><span class="o">=</span><span class="n">date_to</span><span class="p">,</span>
                                <span class="n">limit</span><span class="o">=</span><span class="n">data_query_limit</span><span class="p">)</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">resp</span><span class="p">[</span><span class="s1">&#39;results&#39;</span><span class="p">]</span>
<span class="n">df_pm25</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">r</span><span class="p">)</span>
<span class="n">df_pm25</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">date_pollutant_value</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">pollutant</span><span class="p">)</span>

<span class="n">df_pm25</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>date</th>
      <th>pm25</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>3751</th>
      <td>2021-08-31 17:00:00</td>
      <td>11</td>
    </tr>
    <tr>
      <th>3750</th>
      <td>2021-08-31 18:00:00</td>
      <td>12</td>
    </tr>
    <tr>
      <th>3749</th>
      <td>2021-08-31 19:00:00</td>
      <td>15</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Merge dataframes on &#39;date&#39; (find the intersection of values based on &#39;date&#39;)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df_co</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df_no2</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;inner&#39;</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;date&#39;</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df_o3</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;inner&#39;</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;date&#39;</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df_pm25</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;inner&#39;</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;date&#39;</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s1">&#39;date&#39;</span><span class="p">])</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>co</th>
      <th>no2</th>
      <th>o3</th>
      <th>pm25</th>
    </tr>
    <tr>
      <th>date</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2021-08-31 17:00:00</th>
      <td>0.30</td>
      <td>0.002</td>
      <td>0.031</td>
      <td>11</td>
    </tr>
    <tr>
      <th>2021-08-31 18:00:00</th>
      <td>0.30</td>
      <td>0.003</td>
      <td>0.031</td>
      <td>12</td>
    </tr>
    <tr>
      <th>2021-08-31 19:00:00</th>
      <td>0.30</td>
      <td>0.004</td>
      <td>0.030</td>
      <td>15</td>
    </tr>
    <tr>
      <th>2021-08-31 20:00:00</th>
      <td>0.36</td>
      <td>0.006</td>
      <td>0.029</td>
      <td>14</td>
    </tr>
    <tr>
      <th>2021-08-31 21:00:00</th>
      <td>0.37</td>
      <td>0.006</td>
      <td>0.028</td>
      <td>12</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>2022-02-28 12:00:00</th>
      <td>0.47</td>
      <td>0.025</td>
      <td>0.023</td>
      <td>15</td>
    </tr>
    <tr>
      <th>2022-02-28 13:00:00</th>
      <td>0.46</td>
      <td>0.025</td>
      <td>0.026</td>
      <td>20</td>
    </tr>
    <tr>
      <th>2022-02-28 14:00:00</th>
      <td>0.38</td>
      <td>0.016</td>
      <td>0.038</td>
      <td>13</td>
    </tr>
    <tr>
      <th>2022-02-28 15:00:00</th>
      <td>0.32</td>
      <td>0.012</td>
      <td>0.043</td>
      <td>9</td>
    </tr>
    <tr>
      <th>2022-02-28 16:00:00</th>
      <td>0.30</td>
      <td>0.011</td>
      <td>0.040</td>
      <td>6</td>
    </tr>
  </tbody>
</table>
<p>3526 rows × 4 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># MinMax Scaling</span>
<span class="n">scaler</span> <span class="o">=</span> <span class="n">RobustScaler</span><span class="p">()</span>
<span class="n">co_scaled</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;co&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;co&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">co_scaled</span>

<span class="n">scaler</span> <span class="o">=</span> <span class="n">RobustScaler</span><span class="p">()</span>
<span class="n">co_scaled</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;no2&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;no2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">co_scaled</span>

<span class="n">scaler</span> <span class="o">=</span> <span class="n">RobustScaler</span><span class="p">()</span>
<span class="n">co_scaled</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;o3&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;o3&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">co_scaled</span>

<span class="n">df</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">subplots</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Robust Scaler&#39;</span><span class="p">)</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">autofmt_xdate</span><span class="p">()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;./figures/scaling_ver1.png&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/MainAnalysis_9_0.png" src="_images/MainAnalysis_9_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Make data stationary</span>
<span class="c1"># Differencing technique was applied</span>

<span class="n">co_diff</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">differencing</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;co&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
<span class="n">no2_diff</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">differencing</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;no2&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
<span class="n">o3_diff</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">differencing</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;o3&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
<span class="c1"># Delete the first row</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>

<span class="n">df</span><span class="p">[</span><span class="s1">&#39;co&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">co_diff</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;no2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">no2_diff</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;o3&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">o3_diff</span>
<span class="n">df</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">subplots</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Differencing&#39;</span><span class="p">)</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">autofmt_xdate</span><span class="p">()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;./figures/differencing_ver1.png&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/tmp/ipykernel_7700/3874090531.py:10: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[&#39;co&#39;] = co_diff
/tmp/ipykernel_7700/3874090531.py:11: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[&#39;no2&#39;] = no2_diff
/tmp/ipykernel_7700/3874090531.py:12: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[&#39;o3&#39;] = o3_diff
</pre></div>
</div>
<img alt="_images/MainAnalysis_10_1.png" src="_images/MainAnalysis_10_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># correlation among features</span>
<span class="n">df_corr</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span>
<span class="n">df_corr</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;./tables/correlation_ver1.csv&#39;</span><span class="p">)</span>
<span class="n">df_corr</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>co</th>
      <th>no2</th>
      <th>o3</th>
      <th>pm25</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>co</th>
      <td>1.000000</td>
      <td>0.673827</td>
      <td>-0.623135</td>
      <td>-0.118771</td>
    </tr>
    <tr>
      <th>no2</th>
      <td>0.673827</td>
      <td>1.000000</td>
      <td>-0.770821</td>
      <td>-0.113108</td>
    </tr>
    <tr>
      <th>o3</th>
      <td>-0.623135</td>
      <td>-0.770821</td>
      <td>1.000000</td>
      <td>0.080400</td>
    </tr>
    <tr>
      <th>pm25</th>
      <td>-0.118771</td>
      <td>-0.113108</td>
      <td>0.080400</td>
      <td>1.000000</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># feature vectors: shape (num of data, window size, num of features)</span>
<span class="n">feature_np</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s1">&#39;co&#39;</span><span class="p">,</span> <span class="s1">&#39;no2&#39;</span><span class="p">,</span> <span class="s1">&#39;o3&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>

<span class="c1"># label vactors: shape (num of data,)</span>
<span class="n">label_np</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s1">&#39;pm25&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
<span class="n">X</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">y</span> <span class="o">=</span> <span class="p">[]</span>

<span class="c1"># how many timesteps we want to look at --&gt; default 8 (hours)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">feature_np</span><span class="p">)):</span>
    <span class="n">X</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">feature_np</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">8</span><span class="p">:</span><span class="n">i</span><span class="p">,</span> <span class="p">:])</span>
    <span class="n">y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">label_np</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

<span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
<span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">y</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>((3517, 8, 3), (3517, 1))
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">TEST_SIZE</span> <span class="o">=</span> <span class="mi">300</span>

<span class="n">X_train</span> <span class="o">=</span> <span class="n">X</span><span class="p">[:</span><span class="o">-</span><span class="n">TEST_SIZE</span><span class="p">]</span>
<span class="n">y_train</span> <span class="o">=</span> <span class="n">y</span><span class="p">[:</span><span class="o">-</span><span class="n">TEST_SIZE</span><span class="p">]</span>
<span class="n">X_test</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="o">-</span><span class="n">TEST_SIZE</span><span class="p">:]</span>
<span class="n">y_test</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="o">-</span><span class="n">TEST_SIZE</span><span class="p">:]</span>


<span class="n">X_train</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">y_train</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">X_test</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">y_test</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>((3217, 8, 3), (3217, 1), (300, 8, 3), (300, 1))
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Predict pm2.5 using Gated Recurrent Unit</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">Sequential</span><span class="p">()</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">GRU</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
              <span class="n">return_sequences</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
              <span class="n">input_shape</span><span class="o">=</span><span class="n">X_train</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>
              <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;tanh&#39;</span><span class="p">))</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">GRU</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;tanh&#39;</span><span class="p">))</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Dense</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>

<span class="c1"># Compiling the GRU</span>
<span class="n">model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">optimizer</span><span class="o">=</span><span class="n">SGD</span><span class="p">(</span><span class="n">learning_rate</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">decay</span><span class="o">=</span><span class="mf">1e-7</span><span class="p">,</span>
                            <span class="n">momentum</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span> <span class="n">nesterov</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
              <span class="n">loss</span><span class="o">=</span><span class="s1">&#39;mse&#39;</span><span class="p">)</span>

<span class="n">model</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-05-12 03:39:34.489909: I tensorflow/core/platform/cpu_feature_guard.cc:151] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  SSE4.1 SSE4.2 AVX AVX2 FMA
To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Model: &quot;sequential&quot;
_________________________________________________________________
 Layer (type)                Output Shape              Param #   
=================================================================
 gru (GRU)                   (None, 8, 50)             8250      
                                                                 
 gru_1 (GRU)                 (None, 50)                15300     
                                                                 
 dense (Dense)               (None, 2)                 102       
                                                                 
=================================================================
Total params: 23,652
Trainable params: 23,652
Non-trainable params: 0
_________________________________________________________________
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># model training</span>
<span class="c1">#early_stop = EarlyStopping(monitor=&#39;loss&#39;, mode=&#39;min&#39;, verbose=0, patience=10)</span>
<span class="c1">#model.fit(X_train, y_train, epochs=100, batch_size=150, verbose=1, callbacks=[early_stop])</span>

<span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">150</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 1/100
22/22 [==============================] - 3s 15ms/step - loss: 61.7825
Epoch 2/100
22/22 [==============================] - 0s 14ms/step - loss: 47.2600
Epoch 3/100
22/22 [==============================] - 0s 15ms/step - loss: 46.5220
Epoch 4/100
22/22 [==============================] - 0s 14ms/step - loss: 46.0431
Epoch 5/100
22/22 [==============================] - 0s 14ms/step - loss: 45.9086
Epoch 6/100
22/22 [==============================] - 0s 14ms/step - loss: 45.9669
Epoch 7/100
22/22 [==============================] - 0s 14ms/step - loss: 46.2019
Epoch 8/100
22/22 [==============================] - 0s 13ms/step - loss: 43.4890
Epoch 9/100
22/22 [==============================] - 0s 14ms/step - loss: 41.3602
Epoch 10/100
22/22 [==============================] - 0s 15ms/step - loss: 39.4300
Epoch 11/100
22/22 [==============================] - 0s 15ms/step - loss: 38.2915
Epoch 12/100
22/22 [==============================] - 0s 15ms/step - loss: 40.1313
Epoch 13/100
22/22 [==============================] - 0s 15ms/step - loss: 37.6508
Epoch 14/100
22/22 [==============================] - 0s 14ms/step - loss: 36.5795
Epoch 15/100
22/22 [==============================] - 0s 14ms/step - loss: 36.3274
Epoch 16/100
22/22 [==============================] - 0s 14ms/step - loss: 35.6911
Epoch 17/100
22/22 [==============================] - 0s 14ms/step - loss: 35.0691
Epoch 18/100
22/22 [==============================] - 0s 14ms/step - loss: 35.2598
Epoch 19/100
22/22 [==============================] - 0s 14ms/step - loss: 36.0980
Epoch 20/100
22/22 [==============================] - 0s 15ms/step - loss: 34.3189
Epoch 21/100
22/22 [==============================] - 0s 15ms/step - loss: 33.0377
Epoch 22/100
22/22 [==============================] - 0s 14ms/step - loss: 32.3313
Epoch 23/100
22/22 [==============================] - 0s 14ms/step - loss: 31.3445
Epoch 24/100
22/22 [==============================] - 0s 14ms/step - loss: 30.9620
Epoch 25/100
22/22 [==============================] - 0s 15ms/step - loss: 29.8989
Epoch 26/100
22/22 [==============================] - 0s 16ms/step - loss: 28.9788
Epoch 27/100
22/22 [==============================] - 0s 14ms/step - loss: 28.2696
Epoch 28/100
22/22 [==============================] - 0s 14ms/step - loss: 27.7180
Epoch 29/100
22/22 [==============================] - 0s 14ms/step - loss: 28.8570
Epoch 30/100
22/22 [==============================] - 0s 15ms/step - loss: 26.2209
Epoch 31/100
22/22 [==============================] - 0s 15ms/step - loss: 25.1053
Epoch 32/100
22/22 [==============================] - 0s 15ms/step - loss: 24.3861
Epoch 33/100
22/22 [==============================] - 0s 14ms/step - loss: 23.9058
Epoch 34/100
22/22 [==============================] - 0s 15ms/step - loss: 23.0863
Epoch 35/100
22/22 [==============================] - 0s 14ms/step - loss: 22.9559
Epoch 36/100
22/22 [==============================] - 0s 14ms/step - loss: 22.4067
Epoch 37/100
22/22 [==============================] - 0s 15ms/step - loss: 19.7727
Epoch 38/100
22/22 [==============================] - 0s 15ms/step - loss: 18.2430
Epoch 39/100
22/22 [==============================] - 0s 14ms/step - loss: 16.6916
Epoch 40/100
22/22 [==============================] - 0s 15ms/step - loss: 17.0721
Epoch 41/100
22/22 [==============================] - 0s 14ms/step - loss: 17.3268
Epoch 42/100
22/22 [==============================] - 0s 15ms/step - loss: 16.3780
Epoch 43/100
22/22 [==============================] - 0s 14ms/step - loss: 14.5547
Epoch 44/100
22/22 [==============================] - 0s 15ms/step - loss: 13.6701
Epoch 45/100
22/22 [==============================] - 0s 15ms/step - loss: 13.8296
Epoch 46/100
22/22 [==============================] - 0s 14ms/step - loss: 13.4327
Epoch 47/100
22/22 [==============================] - 0s 15ms/step - loss: 12.2368
Epoch 48/100
22/22 [==============================] - 0s 15ms/step - loss: 11.6621
Epoch 49/100
22/22 [==============================] - 0s 14ms/step - loss: 10.4138
Epoch 50/100
22/22 [==============================] - 0s 15ms/step - loss: 9.2011
Epoch 51/100
22/22 [==============================] - 0s 15ms/step - loss: 9.1597
Epoch 52/100
22/22 [==============================] - 0s 15ms/step - loss: 8.2274
Epoch 53/100
22/22 [==============================] - 0s 16ms/step - loss: 7.9333
Epoch 54/100
22/22 [==============================] - 0s 15ms/step - loss: 7.3819
Epoch 55/100
22/22 [==============================] - 0s 15ms/step - loss: 7.3128
Epoch 56/100
22/22 [==============================] - 0s 15ms/step - loss: 6.6691
Epoch 57/100
22/22 [==============================] - 0s 15ms/step - loss: 6.8974
Epoch 58/100
22/22 [==============================] - 0s 15ms/step - loss: 6.2350
Epoch 59/100
22/22 [==============================] - 0s 15ms/step - loss: 5.3208
Epoch 60/100
22/22 [==============================] - 0s 15ms/step - loss: 5.3226
Epoch 61/100
22/22 [==============================] - 0s 15ms/step - loss: 4.9757
Epoch 62/100
22/22 [==============================] - 0s 15ms/step - loss: 4.7543
Epoch 63/100
22/22 [==============================] - 0s 16ms/step - loss: 4.3134
Epoch 64/100
22/22 [==============================] - 0s 15ms/step - loss: 3.9720
Epoch 65/100
22/22 [==============================] - 0s 15ms/step - loss: 3.4406
Epoch 66/100
22/22 [==============================] - 0s 16ms/step - loss: 3.1337
Epoch 67/100
22/22 [==============================] - 0s 15ms/step - loss: 3.2613
Epoch 68/100
22/22 [==============================] - 0s 15ms/step - loss: 4.1395
Epoch 69/100
22/22 [==============================] - 0s 15ms/step - loss: 4.7379
Epoch 70/100
22/22 [==============================] - 0s 14ms/step - loss: 4.3833
Epoch 71/100
22/22 [==============================] - 0s 15ms/step - loss: 3.7696
Epoch 72/100
22/22 [==============================] - 0s 15ms/step - loss: 3.3501
Epoch 73/100
22/22 [==============================] - 0s 16ms/step - loss: 2.7507
Epoch 74/100
22/22 [==============================] - 0s 15ms/step - loss: 2.3119
Epoch 75/100
22/22 [==============================] - 0s 15ms/step - loss: 1.9574
Epoch 76/100
22/22 [==============================] - 0s 14ms/step - loss: 1.7500
Epoch 77/100
22/22 [==============================] - 0s 14ms/step - loss: 1.7945
Epoch 78/100
22/22 [==============================] - 0s 15ms/step - loss: 1.7374
Epoch 79/100
22/22 [==============================] - 0s 14ms/step - loss: 1.5639
Epoch 80/100
22/22 [==============================] - 0s 15ms/step - loss: 1.4988
Epoch 81/100
22/22 [==============================] - 0s 15ms/step - loss: 1.5989
Epoch 82/100
22/22 [==============================] - 0s 14ms/step - loss: 1.3911
Epoch 83/100
22/22 [==============================] - 0s 15ms/step - loss: 1.2364
Epoch 84/100
22/22 [==============================] - 0s 15ms/step - loss: 1.1558
Epoch 85/100
22/22 [==============================] - 0s 14ms/step - loss: 1.1362
Epoch 86/100
22/22 [==============================] - 0s 15ms/step - loss: 1.0861
Epoch 87/100
22/22 [==============================] - 0s 15ms/step - loss: 0.9349
Epoch 88/100
22/22 [==============================] - 0s 14ms/step - loss: 0.8588
Epoch 89/100
22/22 [==============================] - 0s 15ms/step - loss: 0.7909
Epoch 90/100
22/22 [==============================] - 0s 15ms/step - loss: 0.7393
Epoch 91/100
22/22 [==============================] - 0s 14ms/step - loss: 0.8159
Epoch 92/100
22/22 [==============================] - 0s 14ms/step - loss: 0.7322
Epoch 93/100
22/22 [==============================] - 0s 14ms/step - loss: 0.7075
Epoch 94/100
22/22 [==============================] - 0s 14ms/step - loss: 0.6991
Epoch 95/100
22/22 [==============================] - 0s 15ms/step - loss: 0.6262
Epoch 96/100
22/22 [==============================] - 0s 15ms/step - loss: 0.6037
Epoch 97/100
22/22 [==============================] - 0s 15ms/step - loss: 0.7232
Epoch 98/100
22/22 [==============================] - 0s 15ms/step - loss: 0.7145
Epoch 99/100
22/22 [==============================] - 0s 14ms/step - loss: 0.5586
Epoch 100/100
22/22 [==============================] - 0s 14ms/step - loss: 0.5060
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;keras.callbacks.History at 0x7f66744f5100&gt;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Results for version 1</span>
<span class="n">pred</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<span class="n">pred</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">pred</span><span class="p">]</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;actual&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">pred</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;prediction&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;orange&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Prediction on concentrations of pm 2.5 using GRU ver.1&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;time step (hour)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;concentrations of pm 2.5 (ug/m^3)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;./figures/prediction_results_ver1.png&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/MainAnalysis_16_0.png" src="_images/MainAnalysis_16_0.png" />
</div>
</div>
</div>
<div class="section" id="version-2">
<h2>Version 2<a class="headerlink" href="#version-2" title="Permalink to this headline">¶</a></h2>
<div class="section" id="regression-with-wind-speed-and-relative-humidity-data">
<h3>Regression with wind speed and relative humidity data<a class="headerlink" href="#regression-with-wind-speed-and-relative-humidity-data" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">date_from</span> <span class="o">=</span> <span class="s1">&#39;2022-05-02T00:00:00Z&#39;</span>
<span class="n">date_to</span> <span class="o">=</span> <span class="s1">&#39;2022-05-10T00:00:00Z&#39;</span>
<span class="n">city</span> <span class="o">=</span> <span class="s1">&#39;San Francisco-Oakland-Fremont&#39;</span>
<span class="n">location</span> <span class="o">=</span> <span class="s1">&#39;Oakland&#39;</span>
<span class="n">data_query_limit</span> <span class="o">=</span> <span class="mi">150</span>

<span class="n">date_from_utc</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">pst_to_utc</span><span class="p">(</span><span class="n">date_from</span><span class="p">)</span>
<span class="n">date_to_utc</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">pst_to_utc</span><span class="p">(</span><span class="n">date_to</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># co</span>
<span class="c1"># From 2022-05-02 To 2022-05-10</span>

<span class="n">pollutant</span> <span class="o">=</span> <span class="s1">&#39;co&#39;</span>
<span class="n">status</span><span class="p">,</span> <span class="n">resp</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">measurements</span><span class="p">(</span><span class="n">city</span><span class="o">=</span><span class="n">city</span><span class="p">,</span>
                                <span class="n">location</span><span class="o">=</span><span class="n">location</span><span class="p">,</span> <span class="n">parameter</span><span class="o">=</span><span class="n">pollutant</span><span class="p">,</span>
                                <span class="n">date_from</span><span class="o">=</span><span class="n">date_from</span><span class="p">,</span>
                                <span class="n">date_to</span><span class="o">=</span><span class="n">date_to</span><span class="p">,</span>
                                <span class="n">limit</span><span class="o">=</span><span class="n">data_query_limit</span><span class="p">)</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">resp</span><span class="p">[</span><span class="s1">&#39;results&#39;</span><span class="p">]</span>
<span class="n">df_co</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">date_pollutant_value</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">pollutant</span><span class="p">)</span>
<span class="n">df_co</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>date</th>
      <th>co</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>149</th>
      <td>2022-05-02 23:00:00</td>
      <td>0.42</td>
    </tr>
    <tr>
      <th>148</th>
      <td>2022-05-03 00:00:00</td>
      <td>0.29</td>
    </tr>
    <tr>
      <th>147</th>
      <td>2022-05-03 01:00:00</td>
      <td>0.29</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># no2</span>
<span class="n">pollutant</span> <span class="o">=</span> <span class="s1">&#39;no2&#39;</span>
<span class="n">status</span><span class="p">,</span> <span class="n">resp</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">measurements</span><span class="p">(</span><span class="n">city</span><span class="o">=</span><span class="n">city</span><span class="p">,</span>
                                <span class="n">location</span><span class="o">=</span><span class="n">location</span><span class="p">,</span> <span class="n">parameter</span><span class="o">=</span><span class="n">pollutant</span><span class="p">,</span>
                                <span class="n">date_from</span><span class="o">=</span><span class="n">date_from</span><span class="p">,</span>
                                <span class="n">date_to</span><span class="o">=</span><span class="n">date_to</span><span class="p">,</span>
                                <span class="n">limit</span><span class="o">=</span><span class="n">data_query_limit</span><span class="p">)</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">resp</span><span class="p">[</span><span class="s1">&#39;results&#39;</span><span class="p">]</span>
<span class="n">df_no2</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">date_pollutant_value</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">pollutant</span><span class="p">)</span>

<span class="n">df_no2</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>date</th>
      <th>no2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>149</th>
      <td>2022-05-02 23:00:00</td>
      <td>0.013</td>
    </tr>
    <tr>
      <th>148</th>
      <td>2022-05-03 00:00:00</td>
      <td>0.007</td>
    </tr>
    <tr>
      <th>147</th>
      <td>2022-05-03 01:00:00</td>
      <td>0.006</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># o3</span>
<span class="n">pollutant</span> <span class="o">=</span> <span class="s1">&#39;o3&#39;</span>
<span class="n">status</span><span class="p">,</span> <span class="n">resp</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">measurements</span><span class="p">(</span><span class="n">city</span><span class="o">=</span><span class="n">city</span><span class="p">,</span>
                                <span class="n">location</span><span class="o">=</span><span class="n">location</span><span class="p">,</span> <span class="n">parameter</span><span class="o">=</span><span class="n">pollutant</span><span class="p">,</span>
                                <span class="n">date_from</span><span class="o">=</span><span class="n">date_from</span><span class="p">,</span>
                                <span class="n">date_to</span><span class="o">=</span><span class="n">date_to</span><span class="p">,</span>
                                <span class="n">limit</span><span class="o">=</span><span class="n">data_query_limit</span><span class="p">)</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">resp</span><span class="p">[</span><span class="s1">&#39;results&#39;</span><span class="p">]</span>
<span class="n">df_o3</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">r</span><span class="p">)</span>
<span class="n">df_o3</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">date_pollutant_value</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">pollutant</span><span class="p">)</span>

<span class="n">df_o3</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>date</th>
      <th>o3</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>149</th>
      <td>2022-05-02 23:00:00</td>
      <td>0.016</td>
    </tr>
    <tr>
      <th>148</th>
      <td>2022-05-03 00:00:00</td>
      <td>0.019</td>
    </tr>
    <tr>
      <th>147</th>
      <td>2022-05-03 01:00:00</td>
      <td>0.019</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># pm25</span>
<span class="n">pollutant</span> <span class="o">=</span> <span class="s1">&#39;pm25&#39;</span>
<span class="n">status</span><span class="p">,</span> <span class="n">resp</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">measurements</span><span class="p">(</span><span class="n">city</span><span class="o">=</span><span class="n">city</span><span class="p">,</span>
                                <span class="n">location</span><span class="o">=</span><span class="n">location</span><span class="p">,</span> <span class="n">parameter</span><span class="o">=</span><span class="n">pollutant</span><span class="p">,</span>
                                <span class="n">date_from</span><span class="o">=</span><span class="n">date_from</span><span class="p">,</span>
                                <span class="n">date_to</span><span class="o">=</span><span class="n">date_to</span><span class="p">,</span>
                                <span class="n">limit</span><span class="o">=</span><span class="n">data_query_limit</span><span class="p">)</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">resp</span><span class="p">[</span><span class="s1">&#39;results&#39;</span><span class="p">]</span>
<span class="n">df_pm25</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">r</span><span class="p">)</span>
<span class="n">df_pm25</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">date_pollutant_value</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">pollutant</span><span class="p">)</span>

<span class="n">df_pm25</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>date</th>
      <th>pm25</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>149</th>
      <td>2022-05-03 04:00:00</td>
      <td>8</td>
    </tr>
    <tr>
      <th>148</th>
      <td>2022-05-03 05:00:00</td>
      <td>8</td>
    </tr>
    <tr>
      <th>147</th>
      <td>2022-05-03 06:00:00</td>
      <td>7</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Collect NOAA (daily weather) data using NOAA Python SDK contributed by Paulo Kuong(2018)</span>

<span class="n">n</span> <span class="o">=</span> <span class="n">noaa</span><span class="o">.</span><span class="n">NOAA</span><span class="p">()</span>
<span class="n">res</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">get_observations</span><span class="p">(</span><span class="s1">&#39;94603&#39;</span><span class="p">,</span> <span class="s1">&#39;US&#39;</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="n">date_from_utc</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="n">date_to_utc</span><span class="p">,</span> <span class="n">num_of_stations</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">dates</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">windspeed</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">relativehum</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">res</span><span class="p">:</span>
    <span class="n">dates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">utc_to_pst</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]))</span>
    <span class="n">windspeed</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="s1">&#39;windSpeed&#39;</span><span class="p">][</span><span class="s1">&#39;value&#39;</span><span class="p">])</span>
    <span class="n">relativehum</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="s1">&#39;relativeHumidity&#39;</span><span class="p">][</span><span class="s1">&#39;value&#39;</span><span class="p">])</span>
<span class="n">df_w</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
<span class="n">df_w</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dates</span>
<span class="n">df_w</span><span class="p">[</span><span class="s1">&#39;wind speed&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">windspeed</span>
<span class="n">df_w</span><span class="p">[</span><span class="s1">&#39;relative humidity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">relativehum</span>
<span class="n">df_w</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df_w</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">])</span>

<span class="c1"># fill na with median</span>
<span class="n">df_w</span><span class="p">[[</span><span class="s1">&#39;wind speed&#39;</span><span class="p">,</span> <span class="s1">&#39;relative humidity&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">df_w</span><span class="p">[[</span><span class="s1">&#39;wind speed&#39;</span><span class="p">,</span> <span class="s1">&#39;relative humidity&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">df_w</span><span class="p">[[</span><span class="s1">&#39;wind speed&#39;</span><span class="p">,</span> <span class="s1">&#39;relative humidity&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">median</span><span class="p">())</span>
<span class="n">df_w</span> <span class="o">=</span> <span class="n">df_w</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s2">&quot;date&quot;</span><span class="p">)</span>
<span class="c1"># df.to_csv(&#39;./fillna weather.csv&#39;)</span>


<span class="n">df_w</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_w</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">))</span>

<span class="n">df_w</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>date</th>
      <th>wind speed</th>
      <th>relative humidity</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>72</th>
      <td>2022-05-04 18:00:00</td>
      <td>25.92</td>
      <td>71.830366</td>
    </tr>
    <tr>
      <th>52</th>
      <td>2022-05-04 19:00:00</td>
      <td>20.52</td>
      <td>80.266011</td>
    </tr>
    <tr>
      <th>43</th>
      <td>2022-05-04 20:00:00</td>
      <td>29.52</td>
      <td>86.313549</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># merge every dataframe on a date</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df_co</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df_no2</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;inner&#39;</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;date&#39;</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df_o3</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;inner&#39;</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;date&#39;</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df_w</span><span class="p">,</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;inner&#39;</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;date&#39;</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df_pm25</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;inner&#39;</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;date&#39;</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s1">&#39;date&#39;</span><span class="p">])</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>co</th>
      <th>no2</th>
      <th>o3</th>
      <th>wind speed</th>
      <th>relative humidity</th>
      <th>pm25</th>
    </tr>
    <tr>
      <th>date</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2022-05-04 18:00:00</th>
      <td>0.29</td>
      <td>0.009</td>
      <td>0.027</td>
      <td>25.92</td>
      <td>71.830366</td>
      <td>11</td>
    </tr>
    <tr>
      <th>2022-05-04 19:00:00</th>
      <td>0.28</td>
      <td>0.009</td>
      <td>0.023</td>
      <td>20.52</td>
      <td>80.266011</td>
      <td>12</td>
    </tr>
    <tr>
      <th>2022-05-04 20:00:00</th>
      <td>0.30</td>
      <td>0.009</td>
      <td>0.023</td>
      <td>29.52</td>
      <td>86.313549</td>
      <td>13</td>
    </tr>
    <tr>
      <th>2022-05-04 21:00:00</th>
      <td>0.26</td>
      <td>0.010</td>
      <td>0.023</td>
      <td>24.12</td>
      <td>89.229634</td>
      <td>9</td>
    </tr>
    <tr>
      <th>2022-05-04 22:00:00</th>
      <td>0.27</td>
      <td>0.011</td>
      <td>0.022</td>
      <td>18.36</td>
      <td>89.229634</td>
      <td>10</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>2022-05-09 12:00:00</th>
      <td>0.22</td>
      <td>0.002</td>
      <td>0.041</td>
      <td>25.92</td>
      <td>47.248268</td>
      <td>3</td>
    </tr>
    <tr>
      <th>2022-05-09 13:00:00</th>
      <td>0.22</td>
      <td>0.002</td>
      <td>0.040</td>
      <td>18.36</td>
      <td>43.875674</td>
      <td>6</td>
    </tr>
    <tr>
      <th>2022-05-09 14:00:00</th>
      <td>0.21</td>
      <td>0.002</td>
      <td>0.040</td>
      <td>27.72</td>
      <td>43.875674</td>
      <td>7</td>
    </tr>
    <tr>
      <th>2022-05-09 15:00:00</th>
      <td>0.21</td>
      <td>0.003</td>
      <td>0.039</td>
      <td>25.92</td>
      <td>42.044566</td>
      <td>4</td>
    </tr>
    <tr>
      <th>2022-05-09 16:00:00</th>
      <td>0.21</td>
      <td>0.003</td>
      <td>0.039</td>
      <td>18.36</td>
      <td>45.606476</td>
      <td>3</td>
    </tr>
  </tbody>
</table>
<p>112 rows × 6 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Scaling</span>
<span class="n">scaler</span> <span class="o">=</span> <span class="n">RobustScaler</span><span class="p">()</span>
<span class="n">co_scaled</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;co&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;co&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">co_scaled</span>

<span class="n">scaler</span> <span class="o">=</span> <span class="n">RobustScaler</span><span class="p">()</span>
<span class="n">co_scaled</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;no2&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;no2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">co_scaled</span>

<span class="n">scaler</span> <span class="o">=</span> <span class="n">RobustScaler</span><span class="p">()</span>
<span class="n">co_scaled</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;o3&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;o3&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">co_scaled</span>

<span class="n">scaler</span> <span class="o">=</span> <span class="n">RobustScaler</span><span class="p">()</span>
<span class="n">co_scaled</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;o3&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;wind speed&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">co_scaled</span>

<span class="n">scaler</span> <span class="o">=</span> <span class="n">RobustScaler</span><span class="p">()</span>
<span class="n">co_scaled</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;o3&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;relative humidity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">co_scaled</span>

<span class="n">plot</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">subplots</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Robust Scaler&#39;</span><span class="p">)</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">autofmt_xdate</span><span class="p">()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;./figures/scaling_ver2.png&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/MainAnalysis_25_0.png" src="_images/MainAnalysis_25_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Make data stationary</span>
<span class="c1"># Differencing technique was applied</span>

<span class="n">co_diff</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">differencing</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;co&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
<span class="n">no2_diff</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">differencing</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;no2&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
<span class="n">o3_diff</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">differencing</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;o3&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
<span class="n">ws_diff</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">differencing</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;wind speed&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
<span class="n">rh_diff</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">differencing</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;relative humidity&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
<span class="c1"># Delete the first row</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>

<span class="n">df</span><span class="p">[</span><span class="s1">&#39;co&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">co_diff</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;no2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">no2_diff</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;o3&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">o3_diff</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;wind speed&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ws_diff</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;relative humidity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rh_diff</span>
<span class="n">plot</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">subplots</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Differencing&#39;</span><span class="p">)</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">autofmt_xdate</span><span class="p">()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;./figures/differencing_ver2.png&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/tmp/ipykernel_7700/1728641024.py:12: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[&#39;co&#39;] = co_diff
/tmp/ipykernel_7700/1728641024.py:13: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[&#39;no2&#39;] = no2_diff
/tmp/ipykernel_7700/1728641024.py:14: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[&#39;o3&#39;] = o3_diff
/tmp/ipykernel_7700/1728641024.py:15: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[&#39;wind speed&#39;] = ws_diff
/tmp/ipykernel_7700/1728641024.py:16: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df[&#39;relative humidity&#39;] = rh_diff
</pre></div>
</div>
<img alt="_images/MainAnalysis_26_1.png" src="_images/MainAnalysis_26_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># correlation among features</span>
<span class="n">df_corr</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span>
<span class="n">df_corr</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;./tables/correlation_ver2.csv&#39;</span><span class="p">)</span>
<span class="n">df_corr</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>co</th>
      <th>no2</th>
      <th>o3</th>
      <th>wind speed</th>
      <th>relative humidity</th>
      <th>pm25</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>co</th>
      <td>1.000000</td>
      <td>0.614983</td>
      <td>-0.587944</td>
      <td>-0.587944</td>
      <td>-0.587944</td>
      <td>-0.132807</td>
    </tr>
    <tr>
      <th>no2</th>
      <td>0.614983</td>
      <td>1.000000</td>
      <td>-0.796106</td>
      <td>-0.796106</td>
      <td>-0.796106</td>
      <td>-0.168784</td>
    </tr>
    <tr>
      <th>o3</th>
      <td>-0.587944</td>
      <td>-0.796106</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>0.120429</td>
    </tr>
    <tr>
      <th>wind speed</th>
      <td>-0.587944</td>
      <td>-0.796106</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>0.120429</td>
    </tr>
    <tr>
      <th>relative humidity</th>
      <td>-0.587944</td>
      <td>-0.796106</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>0.120429</td>
    </tr>
    <tr>
      <th>pm25</th>
      <td>-0.132807</td>
      <td>-0.168784</td>
      <td>0.120429</td>
      <td>0.120429</td>
      <td>0.120429</td>
      <td>1.000000</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># feature vectors: shape (num of data, window size, num of features)</span>
<span class="n">feature_np</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s1">&#39;co&#39;</span><span class="p">,</span> <span class="s1">&#39;no2&#39;</span><span class="p">,</span> <span class="s1">&#39;o3&#39;</span><span class="p">,</span> <span class="s1">&#39;wind speed&#39;</span><span class="p">,</span> <span class="s1">&#39;relative humidity&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>

<span class="c1"># label vactors: shape (num of data,)</span>
<span class="n">label_np</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s1">&#39;pm25&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
<span class="n">X</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">y</span> <span class="o">=</span> <span class="p">[]</span>

<span class="c1"># how many timesteps we want to look at --&gt; default 8 (hours)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">feature_np</span><span class="p">)):</span>
    <span class="n">X</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">feature_np</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">8</span><span class="p">:</span><span class="n">i</span><span class="p">,</span> <span class="p">:])</span>
    <span class="n">y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">label_np</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

<span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
<span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">y</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>((103, 8, 5), (103, 1))
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">TEST_SIZE</span> <span class="o">=</span> <span class="mi">30</span>

<span class="n">X_train</span> <span class="o">=</span> <span class="n">X</span><span class="p">[:</span><span class="o">-</span><span class="n">TEST_SIZE</span><span class="p">]</span>
<span class="n">y_train</span> <span class="o">=</span> <span class="n">y</span><span class="p">[:</span><span class="o">-</span><span class="n">TEST_SIZE</span><span class="p">]</span>
<span class="n">X_test</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="o">-</span><span class="n">TEST_SIZE</span><span class="p">:]</span>
<span class="n">y_test</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="o">-</span><span class="n">TEST_SIZE</span><span class="p">:]</span>


<span class="n">X_train</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">y_train</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">X_test</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">y_test</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>((73, 8, 5), (73, 1), (30, 8, 5), (30, 1))
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Predict pm2.5 using Gated Recurrent Unit</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">Sequential</span><span class="p">()</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">GRU</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
              <span class="n">return_sequences</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
              <span class="n">input_shape</span><span class="o">=</span><span class="n">X_train</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>
              <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;tanh&#39;</span><span class="p">))</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">GRU</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;tanh&#39;</span><span class="p">))</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Dense</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>

<span class="c1"># Compiling the GRU</span>
<span class="n">model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">optimizer</span><span class="o">=</span><span class="n">SGD</span><span class="p">(</span><span class="n">learning_rate</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">decay</span><span class="o">=</span><span class="mf">1e-7</span><span class="p">,</span>
                            <span class="n">momentum</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span> <span class="n">nesterov</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
              <span class="n">loss</span><span class="o">=</span><span class="s1">&#39;mse&#39;</span><span class="p">)</span>

<span class="n">model</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Model: &quot;sequential_1&quot;
_________________________________________________________________
 Layer (type)                Output Shape              Param #   
=================================================================
 gru_2 (GRU)                 (None, 8, 50)             8550      
                                                                 
 gru_3 (GRU)                 (None, 50)                15300     
                                                                 
 dense_1 (Dense)             (None, 2)                 102       
                                                                 
=================================================================
Total params: 23,952
Trainable params: 23,952
Non-trainable params: 0
_________________________________________________________________
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># model training</span>
<span class="n">early_stop</span> <span class="o">=</span> <span class="n">EarlyStopping</span><span class="p">(</span><span class="n">monitor</span><span class="o">=</span><span class="s1">&#39;loss&#39;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;min&#39;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">patience</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">callbacks</span><span class="o">=</span><span class="p">[</span><span class="n">early_stop</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 1/50
1/1 [==============================] - 3s 3s/step - loss: 39.2118
Epoch 2/50
1/1 [==============================] - 0s 16ms/step - loss: 35.9047
Epoch 3/50
1/1 [==============================] - 0s 15ms/step - loss: 30.0764
Epoch 4/50
1/1 [==============================] - 0s 15ms/step - loss: 22.2573
Epoch 5/50
1/1 [==============================] - 0s 15ms/step - loss: 13.3274
Epoch 6/50
1/1 [==============================] - 0s 15ms/step - loss: 6.6729
Epoch 7/50
1/1 [==============================] - 0s 14ms/step - loss: 6.5386
Epoch 8/50
1/1 [==============================] - 0s 15ms/step - loss: 10.8090
Epoch 9/50
1/1 [==============================] - 0s 16ms/step - loss: 12.7183
Epoch 10/50
1/1 [==============================] - 0s 15ms/step - loss: 10.1887
Epoch 11/50
1/1 [==============================] - 0s 15ms/step - loss: 6.9064
Epoch 12/50
1/1 [==============================] - 0s 15ms/step - loss: 5.9878
Epoch 13/50
1/1 [==============================] - 0s 14ms/step - loss: 7.1485
Epoch 14/50
1/1 [==============================] - 0s 13ms/step - loss: 8.6062
Epoch 15/50
1/1 [==============================] - 0s 13ms/step - loss: 8.9615
Epoch 16/50
1/1 [==============================] - 0s 13ms/step - loss: 7.9354
Epoch 17/50
1/1 [==============================] - 0s 13ms/step - loss: 6.3954
Epoch 18/50
1/1 [==============================] - 0s 13ms/step - loss: 5.6047
Epoch 19/50
1/1 [==============================] - 0s 13ms/step - loss: 6.0716
Epoch 20/50
1/1 [==============================] - 0s 13ms/step - loss: 7.0572
Epoch 21/50
1/1 [==============================] - 0s 13ms/step - loss: 7.4110
Epoch 22/50
1/1 [==============================] - 0s 14ms/step - loss: 6.8170
Epoch 23/50
1/1 [==============================] - 0s 13ms/step - loss: 5.9507
Epoch 24/50
1/1 [==============================] - 0s 14ms/step - loss: 5.5706
Epoch 25/50
1/1 [==============================] - 0s 14ms/step - loss: 5.7996
Epoch 26/50
1/1 [==============================] - 0s 14ms/step - loss: 6.2321
Epoch 27/50
1/1 [==============================] - 0s 12ms/step - loss: 6.4381
Epoch 28/50
1/1 [==============================] - 0s 13ms/step - loss: 6.2904
Epoch 29/50
1/1 [==============================] - 0s 14ms/step - loss: 5.9492
Epoch 30/50
1/1 [==============================] - 0s 13ms/step - loss: 5.6633
Epoch 31/50
1/1 [==============================] - 0s 14ms/step - loss: 5.5910
Epoch 32/50
1/1 [==============================] - 0s 14ms/step - loss: 5.7226
Epoch 33/50
1/1 [==============================] - 0s 13ms/step - loss: 5.9103
Epoch 34/50
1/1 [==============================] - 0s 13ms/step - loss: 5.9842
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;keras.callbacks.History at 0x7f66806cc400&gt;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Results for version 2</span>
<span class="n">pred</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<span class="n">pred</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">pred</span><span class="p">]</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;actual&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">pred</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;prediction&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;orange&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Prediction on concentrations of pm 2.5 using GRU ver.2&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;time step (hour)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;concentrations of pm 2.5 (ug/m^3)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;./figures/prediction_results_ver2.png&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/MainAnalysis_32_0.png" src="_images/MainAnalysis_32_0.png" />
</div>
</div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "aqproject"
        },
        kernelOptions: {
            kernelName: "aqproject",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'aqproject'</script>

              </div>
              
            
                <!-- Previous / next buttons -->
<div class='prev-next-area'> 
    <a class='left-prev' id="prev-link" href="modelling.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Analysing the dark day over San Francisco (Sep 9 2020)</p>
        </div>
    </a>
</div>
            
        </div>
    </div>
    <footer class="footer">
  <p>
    
      By Wesley Darling, Gyuhyeon Seo, Jae Hee Koh, Ram Mukund Kripa<br/>
    
        &copy; Copyright 2022.<br/>
  </p>
</footer>
</main>


      </div>
    </div>
  
  <script src="_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

  </body>
</html>